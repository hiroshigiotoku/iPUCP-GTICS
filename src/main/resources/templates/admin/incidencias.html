<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/css/style2.css}"/>

    <!-- DATATABLES -->
    <!--  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css"> -->
    <!-- BOOTSTRAP -->


    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">

    <title>Incidencias</title>
</head>
<body>
<main>

    <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-dark"
         style="height: 100px">
        <div class="container">
            <a class="navbar-brand"><img th:src="@{/img/logo.jpg}" alt="..." style="height: 65px;width: 90px;border-radius: 3px;"/></a>
            <p class="h1" style="color: white">iPUCP</p>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <button class="nav-link dropdown-toggle fw-bold btn btn-dark" href="#" id="navbarDarkDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false" >
                            a20192258@pucp.edu.pe
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="navbarDarkDropdownMenuLink">
                            <li><a class="dropdown-item" th:href="@{'/admin/listar'}">Inicio</a></li>
                            <li><a class="dropdown-item" th:href="@{'/admin'}">Cerrar Sesión</a></li>
                        </ul>
                    </li>
                </ul>
            </div>

        </div>
    </nav>



    <div class="container px-4 py-5">
        </br>
        <section class="page-section bg-light" id="portafolio">
            <h1 class="pb-2 border-bottom" style="text-align: center">Gestión de incidencias</h1>
            </br>

            <div th:if="${msg != null}" th:text="${msg}" class="alert alert-success" role="alert" ></div>

            <div class="container">
                <div class="container">
                    <div class="row, justify-content: center">
                        <div class="row">


                            <div class="col-md-4 mb-4 ">
                                <img th:src="@{/img/iconos.jpg}" class="card-img-top" alt="..." style="max-width: 100%; height: 480px">

                                <p>   </p>

                                <div class="row">
                                    <div class="d-grid gap-2">
                                        <button type="button" class="btn btn-success" style="max-width: 100%" data-bs-toggle="modal" data-bs-target="#Modal3">Agregar Nuevo Tipo</button>
                                    </div>
                                </div>

                            </div>


                            <div class="col-md-8 mb-4 ">

                                <div>
                                    <table class="table table-striped" id="tablax" width="100%">
                                        <thead style="color: #0095f6">
                                        <tr class="table-info">
                                            <th style="text-align: center">Incidencia</th>
                                            <th style="text-align: center">Ver ícono</th>
                                            <th style="text-align: center">Acción</th>
                                            <th style="text-align: center">    </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:each="incid : ${listaIncidencias}">
                                            <th th:text="${incid.tipoIncidencia}" style="text-align: center">Reporte de robo</th>
                                            <td style="text-align: center"><button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#Modal4">Imagen</button></td>
                                            <td style="text-align: center"><button type="button" class="btn btn-primary" data-bs-toggle="modal" th:attr="data-bs-target=${'#ModalEdit'+incid.id}">Editar</button></td>
                                            <td style="text-align: center"><button type="button" class="btn btn-danger" data-bs-toggle="modal" th:attr="data-bs-target=${'#ModalDelete'+incid.id}">Borrar</button></td>
                                        </tr>

                                        </tbody>
                                    </table>
                                </div>

                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal 1-->
    <div th:each="incid : ${listaIncidencias}">
        <div class="modal fade" th:id="${'ModalEdit'+incid.id}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Editar incidencia</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <form method="post" th:action="@{'/admin/updateIncident'}" class="mt-2" th:id="${'form'+incid.id}">
                            <div class="mb-3">
                                <input th:value="${incid.id}" name="id" type="hidden" />

                                <label for="tipoIncidencia1" class="form-label">Nombre de incidencia:</label>
                                <input type="text" id="tipoIncidencia1"name="tipoIncidencia" class="form-control" th:value="${incid.tipoIncidencia}" required/>
                            </div>
                            <div class="mb-3">
                                <label for="foto" class="form-label">Imagen de incidencia:</label>
                                <input type="file" class="btn btn-primary" name="foto" style="background-color:grey; border-color:grey" id="foto">
                            </div>
                        </form>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Regresar</button>
                        <button type="submit" class="btn btn-success" data-bs-dismiss="modal" th:form="${'form'+incid.id}">Cambiar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal 2-->
    <div th:each="incid : ${listaIncidencias}">
        <div class="modal fade" th:id="${'ModalDelete'+incid.id}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header" style="background-color: red">
                        <h5 class="modal-title" id="exampleModalLabel2" style="color: white">¿Seguro de borrar la incidencia?</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <h6 class="modal-title" >La incidencia se encuentra asociada a varios reportes y borrarla podría afectarlos.</h6>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Regresar</button>
                        <a type="button" class="btn btn-danger" th:href="@{'/admin/deleteIncident?id=' + ${incid.id}}">Si, estoy de acuerdo</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal 3-->
    <div class="modal fade" id="Modal3" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel3">Crear nuevo tipo de incidencia</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <form method="post" th:action="@{'/admin/saveIncident'}" class="mt-2" id="form33">
                        <div class="mb-3">
                            <label for="tipoIncidencia2" class="form-label">Nombre de incidencia:</label>
                            <input type="text" id="tipoIncidencia2" name="tipoIncidencia2" class="form-control" required/>
                        </div>
                        <div class="mb-3">
                            <label for="foto" class="form-label">Imagen de incidencia:</label>
                            <input type="file" class="btn btn-primary" name="foto2" style="background-color:grey; border-color:grey" id="foto2">
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Regresar</button>
                    <button type="submit" form="form33" class="btn btn-success" data-bs-dismiss="modal">Agregar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal 4-->
    <div class="modal fade " id="Modal4" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog ">
            <div class="modal-content ">
                <div class="modal-header" style="background-color: green">
                    <h5 class="modal-title" id="exampleModalLabel4" style="color: white">Reporte de robo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <img th:src="@{/img/perfil2.jpg}" class="card-img-top" alt="...">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Regresar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JQUERY -->
    <script src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous">
    </script>
    <!-- DATATABLES -->
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js">
    </script>
    <!-- BOOTSTRAP -->
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js">
    </script>
    <script>
        $(document).ready(function () {
            $('#tablax').DataTable({

                scrollX:        true,
                scrollCollapse: true,

                //"bPaginate": false,
                "bFilter": false,
                //"bInfo": false,
                "ordering": false,
                language: {
                    processing: "Tratamiento en curso...",
                    search: "Búsqueda específica&nbsp;:",
                    lengthMenu: "Agrupar de _MENU_ items",
                    info: "Mostrando item _START_ al _END_ de _TOTAL_ en total",
                    infoEmpty: "No existen datos.",
                    infoFiltered: "(filtrado de _MAX_ elementos en total)",
                    infoPostFix: "",
                    loadingRecords: "Cargando...",
                    zeroRecords: "No se encontraron datos con tu busqueda",
                    emptyTable: "No hay datos disponibles en la tabla.",
                    paginate: {
                        first: "Primero",
                        previous: "Anterior",
                        next: "Siguiente",
                        last: "Ultimo"
                    },
                    aria: {
                        sortAscending: ": active para ordenar la columna en orden ascendente",
                        sortDescending: ": active para ordenar la columna en orden descendente"
                    }
                },
                scrollY: 400,
                lengthMenu: [ [6, 25, -1], [6, 25, "All"] ],
            });
        });
    </script>

</main>
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</body>
</html>